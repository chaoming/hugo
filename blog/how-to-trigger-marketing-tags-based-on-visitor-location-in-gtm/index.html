<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="This article will show you how you can trigger marketing tags based on visitor location with custom location variables in Google Tag Manager."><title>How to trigger marketing tags based on visitor location in GTM</title><link rel=canonical href=https://chaoming.li/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="How to trigger marketing tags based on visitor location in GTM"><meta property='og:description' content="This article will show you how you can trigger marketing tags based on visitor location with custom location variables in Google Tag Manager."><meta property='og:url' content='https://chaoming.li/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/'><meta property='og:site_name' content="Chaoming's Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='digital markeeting'><meta property='article:tag' content='marketing tag'><meta property='article:tag' content='google tag manager'><meta property='article:tag' content='gtm'><meta property='article:tag' content='location'><meta property='article:tag' content='country'><meta property='article:published_time' content='2022-07-07T00:00:00+00:00'><meta property='article:modified_time' content='2022-07-07T00:00:00+00:00'><meta property='og:image' content='https://chaoming.li/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/syj23egvntavpv64up1t.webp'><meta name=twitter:site content="@ChaomingLi"><meta name=twitter:creator content="@ChaomingLi"><meta name=twitter:title content="How to trigger marketing tags based on visitor location in GTM"><meta name=twitter:description content="This article will show you how you can trigger marketing tags based on visitor location with custom location variables in Google Tag Manager."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://chaoming.li/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/syj23egvntavpv64up1t.webp'><script async src="https://www.googletagmanager.com/gtag/js?id=G-MY4GMY6ZN6"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-MY4GMY6ZN6")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu2546606104509332182.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Chaoming's Blog</a></h1><h2 class=site-description>Tech entrepreneur, CEO of Insightech.</h2></div></header><ol class=menu-social><li><a href=https://github.com/chaoming target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/chaomingli/ target=_blank title=LinkedIn rel=me><svg class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://twitter.com/ChaomingLi target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about-me/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About Me</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/projects/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Projects</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/><img src=/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/syj23egvntavpv64up1t_hu10432301107069399256.webp srcset="/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/syj23egvntavpv64up1t_hu10432301107069399256.webp 800w, /blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/syj23egvntavpv64up1t_hu9552929913178324122.webp 1600w" width=800 height=336 loading=lazy alt="Featured image of post How to trigger marketing tags based on visitor location in GTM"></a></div><div class=article-details><header class=article-category><a href=/categories/digital-marketing/>Digital Marketing</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/>How to trigger marketing tags based on visitor location in GTM</a></h2><h3 class=article-subtitle>This article will show you how you can trigger marketing tags based on visitor location with custom location variables in Google Tag Manager.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 07, 2022</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>3 minute read</time></div></footer></div></header><section class=article-content><p>Location variables are not built-in variables in Google Tag Manager (GTM). This article will show you how you can trigger marketing tags based on visitor location by using VisitorAPI in GTM.</p><p>First, import the VisitorAPI tag template to your GTM container by clicking <strong>Templates</strong> → <strong>Search Gallery</strong>, then search for <a class=link href=https://tagmanager.google.com/gallery/#/owners/visitorapi/templates/visitor-api-google-tag-manager target=_blank rel=noopener>“visitorapi”</a> to import the tag template to your GTM container.</p><p><img src=/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/gtm-visitor-api.png width=775 height=180 srcset="/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/gtm-visitor-api_hu1394800746650089028.png 480w, /blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/gtm-visitor-api_hu17163381737628448307.png 1024w" loading=lazy alt="Import VisitorAPI template in Google Tag Manager" class=gallery-image data-flex-grow=430 data-flex-basis=1033px></p><p>Once the tag template is imported, create a new tag with the <a class=link href=https://www.visitorapi.com/ target=_blank rel=noopener>VisitorAPI</a> tag template, and put in your VisitorAPI project ID. To get a VisitorAPI project ID, sign up for an account and create a free or paid project in VisitorAPI. Don’t forget to add your website domains to the authorised domain list in your VisitorAPI project to make the API works for your website.</p><p><img src=/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/create-visitor-api-tag.png width=957 height=594 srcset="/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/create-visitor-api-tag_hu5032167096408699767.png 480w, /blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/create-visitor-api-tag_hu14629309686127524333.png 1024w" loading=lazy alt="Create VisitorAPI tag in Google Tag Manager" class=gallery-image data-flex-grow=161 data-flex-basis=386px></p><p>The VisitorAPI tag will call the API to retrieve the visitor’s location data including country, state and city, and trigger a new event “visitor-api-success” which you can use to trigger the tags that are targeting certain locations.</p><p>To use the location variables, you will need to create them in your GTM container. VisitorAPI returns the country, state and city of the visitors. Here is how to create those three variables: click <strong>Variables</strong> → <strong>New</strong>, then select <strong>Data Layer Variable</strong>. Name your variables as “Country Code” and input “visitorApiCountryCode” to the <strong>Data Layer Variable Name</strong> field.</p><p><img src=/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/create-visitor-api-variables.png width=1742 height=557 srcset="/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/create-visitor-api-variables_hu4354655918033083984.png 480w, /blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/create-visitor-api-variables_hu8945051977648046138.png 1024w" loading=lazy alt="Create VisitorAPI variables in Google Tag Manager" class=gallery-image data-flex-grow=312 data-flex-basis=750px></p><p>Here is a list of all the variables VisitorAPI returns</p><div class=table-wrapper><table><thead><tr><th>GTM Variable Name</th><th>Data Layer Variable Name</th><th>Description</th></tr></thead><tbody><tr><td>IP Address</td><td>visitorApiIpAddress</td><td>The IP address of the visitor.</td></tr><tr><td>Country Code</td><td>visitorApiCountryCode</td><td>The country from which the visitor is located as an ISO 3166-1 alpha-2 country code.</td></tr><tr><td>Country Name</td><td>visitorApiCountryName</td><td>The full name of the country in which the visitor is located in.</td></tr><tr><td>Currencies</td><td>visitorApiCurrencies</td><td>An array of the official currencies of the country in which the visitor is located.</td></tr><tr><td>Languages</td><td>visitorApiLanguages</td><td>An array of the official languages of the country in which the visitor is located in.</td></tr><tr><td>Region</td><td>visitorApiRegion</td><td>Name of the region, state or province in which the visitor is located. The complete list of valid region values is found in the ISO-3166-2 standard.</td></tr><tr><td>City</td><td>visitorApiCity</td><td>Name of the city in which the visitor is located in.</td></tr><tr><td>City LatLong</td><td>visitorApiCityLatLong</td><td>Latitude and longitude of the city in which the visitor is located in.</td></tr><tr><td>Browser</td><td>visitorApiBrowser</td><td>The browser name which the visitor uses.</td></tr><tr><td>Browser Version</td><td>visitorApiBrowserVersion</td><td>The browser version which the visitor uses.</td></tr><tr><td>Device Brand</td><td>visitorApiDeviceBrand</td><td>The brand of the device which the visitor uses. Only applicable to mobile devices.</td></tr><tr><td>Device Model</td><td>visitorApiDeviceModel</td><td>The model of the device which the visitor uses. Only applicable to mobile devices.</td></tr><tr><td>Device Family</td><td>visitorApiDeviceFamily</td><td>The family of the device which the visitor uses. Only applicable to mobile devices.</td></tr><tr><td>OS</td><td>visitorApiOs</td><td>The operating system name of the device which the visitor uses.</td></tr><tr><td>OS Version</td><td>visitorApiOsVersion</td><td>The operating system version of the device which the visitor uses.</td></tr></tbody></table></div><p>You can use the variables in trigger conditions in your GTM container to fire the tags targeting visitors based on locations. For example, if you want to target visitors in the US, you can create a trigger with the condition “Country Code” equals “us”.</p><p><img src=/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/create-tag-for-us-country.png width=1740 height=559 srcset="/blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/create-tag-for-us-country_hu14060865026325935681.png 480w, /blog/how-to-trigger-marketing-tags-based-on-visitor-location-in-gtm/create-tag-for-us-country_hu16909247242117606558.png 1024w" loading=lazy alt="Create a marketing tag for the US visitors in Google Tag Manager" class=gallery-image data-flex-grow=311 data-flex-basis=747px></p><p>Not only you can trigger tags based on the location variables, but you can also use the variables in your tags as parameters <code>{{Country Code}}</code> to pass the data to your tags.</p><p>The location variables make it possible to personalize user experience based on visitor location by using GTM. Please feel free to leave a comment to share how you will use the location variables in GTM.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/digital-markeeting/>Digital Markeeting</a>
<a href=/tags/marketing-tag/>Marketing Tag</a>
<a href=/tags/google-tag-manager/>Google Tag Manager</a>
<a href=/tags/gtm/>Gtm</a>
<a href=/tags/location/>Location</a>
<a href=/tags/country/>Country</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/blog/build-your-own-web-analytics-platform-in-25-minutes/><div class=article-image><img src=/blog/build-your-own-web-analytics-platform-in-25-minutes/screenshot-2018-02-24-19-46-41_orig-768x427.528ba3775e1cd98e2433ae22e57f838f_hu1911381711740028495.png width=250 height=150 loading=lazy alt="Featured image of post Build Your Own Web Analytics Platform in 25 Minutes" data-hash="md5-Uoujd14c2Y4kM64i5X+Djw=="></div><div class=article-details><h2 class=article-title>Build Your Own Web Analytics Platform in 25 Minutes</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//chaomings-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 Chaoming's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>